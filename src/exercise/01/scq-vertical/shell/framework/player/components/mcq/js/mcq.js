define(["marionette","components/mcq/js/mcq-helper","player/base/base-composite-comp","player/components/checkbox/js/checkbox","player/components/radiobutton/js/radiobutton","text!components/mcq/mcq.html"],function(t,e,i,s,o,n){var a=i.extend({template:_.template(n),isQuestionVisible:!1,isOptionsVisible:!1,isOptionsEnabled:!0,questionData:null,mcqData:null,isCorrect:!1,isAttempted:!1,objFeedbackDiv:null,arrOptFeedbackDiv:[],strOptType:"",arrHookedEvent:[],isReviewMode:!1,selectedOptionsIDs:[],randomize:!1,bReset:!1,initialize:function(t){t?(this.mcqData=t,this.randomize=!1,this.isReviewMode=!1,(this.mcqData.hasOwnProperty("randomize")&&this.mcqData.randomize===!0||"true"===this.mcqData.randomize)&&(this.randomize=!0),this.mcqData.hasOwnProperty("reviewMode")&&this.mcqData.reviewMode===!0&&(this.isReviewMode=!0),this.mcqData.hasOwnProperty("questionData")?this.questionData=this.mcqData.questionData:this.mcqData.hasOwnProperty("label")?this.questionData=this.mcqData:e.createDummyData(this),this.questionData&&(this.itemViewContainer="#optContainer_"+this.questionData.id,"multipleAnswer"===this.questionData.type?(this.itemView=s,this.strOptType="checkbox"):(this.itemView=o,this.strOptType="radio"),this.itemViewOptions={parent:this},e.prepareData(this,this.questionData),this.bReset===!1&&this.mcqData.hasOwnProperty("selectedOptionsIDs")&&(this.selectedOptionsIDs=this.mcqData.selectedOptionsIDs))):e.createDummyData(this),this.bReset=!1},onRender:function(){if(this.$el.removeAttr("class").addClass(this.model.get("theme")),this.isReviewMode)this.disable(),e.autoSelectOptions(this);else{this.questionData&&e.hideQuesFeedback(this,!0);var t,i=this;for(t in i.arrHookedEvent)i.arrHookedEvent.hasOwnProperty(t)&&i.hookEvent(i.arrHookedEvent[t].callbackRef,t,i.arrHookedEvent[t].callback)}this.selectedOptionsIDs.length>0&&e.autoSelectOptions(this,!1)},hookEvent:function(t,e,i){var s={callbackRef:t,callback:i};switch(this.arrHookedEvent[e]=s,e){case this.OPTION_CLICK:this.$("div[data-cid]").bind("click",$.proxy(t[i],t));break;case this.OPTION_CHANGED:this.$("div[data-cid] input").bind("change",s,$.proxy(this.handleOptionChange,this));break;case this.OPTION_MOUSE_OVER:this.$("div[data-cid]").bind("mouseover",s,$.proxy(this.handleOptionRollOver,this));break;case this.OPTION_MOUSE_OUT:this.$("div[data-cid]").bind("mouseout",$.proxy(t[i],t));break;case this.QUESTION_MOUSE_OVER:this.$(".questionText span").bind("mouseover",$.proxy(t[i],t));break;case this.QUESTION_MOUSE_OUT:this.$(".questionText span").bind("mouseout",$.proxy(t[i],t))}},unhookEvent:function(t){switch(t){case this.OPTION_CLICK:this.$("div[data-cid]").unbind("click");break;case this.OPTION_CHANGED:this.$("div[data-cid] input").unbind("change");break;case this.OPTION_MOUSE_OVER:this.$("div[data-cid]").unbind("mouseover");break;case this.OPTION_MOUSE_OUT:this.$("div[data-cid]").unbind("mouseout");break;case this.QUESTION_MOUSE_OVER:this.$(".questionText span").unbind("mouseover");break;case this.QUESTION_MOUSE_OUT:this.$(".questionText span").unbind("mouseout")}},getSelectedOptionsIDs:function(){var t,e=[];return t=this.collection.filter(function(t){return t.get("checked")===!0}),_.each(t,function(t){e.push(t.get("id"))}),e},hideOptions:function(t){e.hideOptions(this,t)},hideQuestion:function(t){e.hideQuestion(this,t)},enable:function(){e.enableOptions(this,!0)},disable:function(){e.enableOptions(this,!1)},checkAnswer:function(){return e.doValidation(this)},showFeedback:function(t){e.showFeedback(this,"global",t)},showAllFeedback:function(t){e.showFeedback(this,"all",t)},showOptionsFeedback:function(t){e.showFeedback(this,"options",t)},reset:function(){this.isReviewMode||(this.flush(),this.bReset=!0,this.initialize(this.mcqData),this.render())},handleOptionChange:function(t){var i,s,o,n;i=$(t.currentTarget).parent(),s=i.attr("data-cid"),o=this.children.findByModelCid(s),n=e.validateOption(this,i,o),t.data&&t.data.callbackRef[t.data.callback]({type:this.OPTION_CHANGED,data:{optionId:o.model.get("id"),isCorrect:n}})},handleOptionRollOver:function(t){var e,i,s,o;e=$(t.currentTarget),i=e.find("input:first-child").attr("id"),o=i.length,s=i.substring(i.lastIndexOf("_")+1,o),t.data.callbackRef[t.data.callback]({type:this.OPTION_MOUSE_OVER,data:{optionId:s}})},onShow:function(){var t=this;this.$el.on("click",$.proxy(t.compClick,t)),this.$el.on("mouseover",$.proxy(t.compRollover,t)),this.$el.on("mouseout",$.proxy(t.compRollout,t))}});return a.prototype._super=i,a.prototype.OPTION_CHANGED="optionChanged",a.prototype.OPTION_MOUSE_OVER="optionMouseOver",a.prototype.OPTION_CLICK="optionClick",a.prototype.QUESTION_MOUSE_OVER="questionMouseOver",a.prototype.OPTION_MOUSE_OUT="optionMouseOut",a.prototype.QUESTION_MOUSE_OUT="questionMouseOut",a.prototype.setQuestionData=function(t){this.flush(),this.questionData=null,this.bReset=!1,this.initialize(t),this.render()},a.prototype.flush=function(){this.unhookEvent(this.OPTION_MOUSE_OVER),this.unhookEvent(this.OPTION_MOUSE_OUT),this.unhookEvent(this.QUESTION_MOUSE_OVER),this.unhookEvent(this.QUESTION_MOUSE_OUT),this.unhookEvent(this.OPTION_CHANGED),this.isQuestionVisible=this.isOptionsVisible=this.isOptionsEnabled=this.isCorrect=this.isAttempted=!1,this.strOptType="";var t;if(this.collection)for(;this.collection.first();)t=this.collection.first(),t.id=null,t.destroy(),t=null;this.model.id=null,this.model.destroy(),this.model=null,this.collection=null,this.objFeedbackDiv=null,this.arrOptFeedbackDiv=[],this.selectedOptionsIDs=[]},a.prototype.validateAnOption=function(t,i,s){e.validateOption(t,i,s)},a.prototype.destroy=function(){this.flush();var t,e=this;for(t in e.arrHookedEvent)e.arrHookedEvent.hasOwnProperty(t)&&(e.unhookEvent(t),delete e.arrHookedEvent[t]);return this.arrHookedEvent=[],this.arrHookedEvent=null,this.unbind(),this.undelegateEvents(),this.children.call("destroy"),this.children.call("remove"),this.questionData=null,this.close(),this.$el.off("click"),this.$el.off("mouseover"),this.$el.off("mouseout"),this._super.prototype.destroy(!0)},a});