define(["marionette","components/container","components/sorting/model","components/sortable/sortable"],function(t,e,o,s){var i,l=e.extend({objData:null,objTimer:null,sortable_dict:[],feedback:null,objSortable:void 0,template:_.template(""),initialize:function(t){this.objData=t,this.model=new o(t),i=this,this.setStageScaleValue(t.updatedScale),this.componentType="sorting"},onRender:function(){this.$el.attr("class",this.styleClass()),this.reset()},onShow:function(){this.customEventDispatcher(this.eventConst.CREATION_COMPLETE,this,this)}});return l.prototype.isValid=function(t){var e=!1;return e="sortable"===t||"feedback"===t||"label"===t?!0:!1},l.prototype.initWithXmlData=function(t){var e,o;e=t.option,e.length?(o=e.pop(),this.initSortableFromXml(o,t)):(this.model.set("answer",t.correctresponce),this.onSortableCreationComplete())},l.prototype.clear=function(){var t,e,o;if(t=this.sortables(),t&&t.length)for(;t.length;)e=t.pop(),o=this[e],o&&(o.$el.remove(),o.destroy(),delete this[e]);this.model.set("sortables","")},l.prototype.initSortableFromXml=function(t,e){var o;o=new s({value:t.id,styleClass:t.style}),o.setID(t.id),this[t.id]=o,this.$el.append(o.render().$el),o.onShow(),o.$el.text(t.label),this.storeSortableFromXml(o),this.initWithXmlData(e)},l.prototype.storeSortableFromXml=function(t){this.storeChilds(t,"sortables")},l.prototype.addChild=function(t){var e=t.component;if(e instanceof s)this.sortable_dict.push(e),this.storeChilds(e,"sortables")&&this.addSortableEvents(e);else if("feedback"===e.componentType)this.feedback=e;else if(!this.bEditor)return console.warn("Sorting can only have Sortable kind of objects!!"),void 0;this.Super.prototype.addChild.call(this,t)},l.prototype.storeChilds=function(t,e){var o,s;return o=this.sortables(),s=o.indexOf(t.getID()),0>s?(o.push(t.getID()),this.model.set(e,o.join("|")),!0):!1},l.prototype.addSortableEvents=function(t){var e=this;t.on(this.eventConst.CREATION_COMPLETE,function(){this.off(e.eventConst.CREATION_COMPLETE),e.onSortableCreationComplete(this)})},l.prototype.onSortableCreationComplete=function(){var t=this;t.objTimer&&clearTimeout(t.objTimer),t.objTimer=setTimeout(function(){t.objTimer=void 0,t.bEditor||t.shuffleSortables(),t.styleSortables()},100)},l.prototype.shuffleSortables=function(){var t,e,o,s,i,l;if("true"===this.model.get("shuffle")||this.model.get("shuffle")===!0){for(e=this.sortables(),o=e.length;0!==o;)s=Math.floor(Math.random()*o),o-=1,l=e[o],e[o]=e[s],e[s]=l;for(this.model.set("sortables",e.join("|")),t=0;t<e.length;t+=1)i=this[e[t]],this.$el.append(i.$el)}},l.prototype.styleSortables=function(){var t,e,o,s=0,i=0,l=0,r=0,a=this;for(s=parseFloat(this.$el.css("padding-left")),i=parseFloat(this.$el.css("padding-top")),t=this.$el.children(),e=0;e<t.length;e+=1)o=t.eq(e),"HORIZONTAL"===this.model.get("direction")?o.css("float","left"):"VERTICAL"===this.model.get("direction");l=this.$el.outerWidth()+parseFloat(this.$el.css("margin-left"))+parseFloat(this.$el.css("margin-right")),r=this.$el.outerHeight()+parseFloat(this.$el.css("margin-top"))+parseFloat(this.$el.css("margin-bottom")),void 0===a.objSortable&&setTimeout(function(){a.applySorting()},100)},l.prototype.applySorting=function(){var t=this;this.bEditor||(this.objSortable=this.$el.sortable({start:function(e,o){$(e.target).data("ui-sortable").floating=!0,t.startL=parseFloat(o.helper.css("left")),t.startT=parseFloat(o.helper.css("top")),t.startX=e.clientX,t.startY=e.clientY,t.placeholder().length&&(o.placeholder.css("visibility","visible"),o.placeholder.addClass(t.placeholder()),"HORIZONTAL"===t.model.get("direction")&&(o.placeholder.css("float","left"),o.placeholder.width(o.helper.width()))),i.customEventDispatcher("start",i,{event:e,ui:o})},cursorAt:t.objData.cursorAt,update:function(e,o){t.styleSortables(),i.customEventDispatcher("update",i,{event:e,ui:o})},sort:function(e,o){var s,l,r;r=t.getStageScaleValue(),1!==r&&(s=(o.originalPosition.left+e.clientX-t.startX)/r,l=(o.originalPosition.top+e.clientY-t.startY)/r,o.helper.css("left",s+"px"),o.helper.css("top",l+"px"),i.customEventDispatcher("sort",i,{event:e,ui:o}))},stop:function(e,o){t.styleSortables(),i.customEventDispatcher("stop",i,{event:e,ui:o})},scroll:!1}))},l.prototype.placeholder=function(t){return t?(this.model.set("placeholder",t),void 0):this.model.get("placeholder")},l.prototype.sortables=function(){var t,e;return e=this.model.get("sortables"),t=e.length>0?e.split("|"):[]},l.prototype.checkAnswer=function(){var t,e,o,s,l=0,r=0,a=!1,n=!0;for(e=[],o=[],s=[],t=this.model.get("answer").split("|"),s=this.$el.children(),r=0;r<s.length;r++)for(l=0;l<this.sortable_dict.length;l++)this.sortable_dict[l].strCompId===s[r].className&&(o.push(this[s[r].className]),e.push(this[s[r].className].value()));for(r=0;r<o.length;r++)a=!1,parseInt(e[r])==parseInt(t[r])&&(a=!0),a===!1&&(n=!1),o[r].checkAnswer(a);return null!==this.feedback&&this.feedback.showFeedback(n),i.customEventDispatcher("onCheckAnswer",i,n),this.sendStatementToLRS("checkAnswer_",a),a},l.prototype.reset=function(){var t,e,o;for(t=this.sortables(),o=0;o<t.length;o+=1)e=this[t[o]],e.reset(),e.$el.removeAttr("style"),this.$el.append(e.$el);this.objSortable&&(this.$el.sortable("destroy"),this.objSortable=void 0),this.styleSortables(),this.hideFeedback()},l.prototype.showFeedback=function(){this.checkAnswer()},l.prototype.hideFeedback=function(){this.feedback&&this.feedback.hide()},l.prototype.enable=function(){this.$el.sortable("enable")},l.prototype.disable=function(){this.$el.sortable("disable")},l.prototype.data=function(t){return t?(this.model.set("data",t),void 0):this.model.get("data")},l.prototype.styleClass=function(t){return t?(this.model.set("styleClass",t),void 0):this.model.get("styleClass")},l.prototype.Super=e,l.prototype.destroy=function(){return this.feedback=null,this.Super.prototype.destroy(!0)},l});