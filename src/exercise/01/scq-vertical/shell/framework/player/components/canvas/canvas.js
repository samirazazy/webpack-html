define(["components/case/case"],function(t){var s;return s=t.extend({template:_.template(""),objData:null,isMouseDown:null,$canvas:null,mouseX:null,mouseY:null,offsetX:null,offsetY:null,lastX:null,lastY:null,initialize:function(t){this.objChildList=[],this.objData=t,this.componentType="canvas"},onRender:function(){this.objData.styleClass;void 0!==this.objData.styleClass&&(this.$el.addClass(this.objData.styleClass),this.$el.attr("id",this.strCompId)),this.bEditor===!1&&(this.$canvas=$('<canvas id="'+this.objData.styleClass+'_canvas" width="'+this.$el.width()+'" height="'+this.$el.height()+'"></canvas>'),this.$el.append(this.$canvas),this.isMouseDown=!1)},onShow:function(){this.customEventDispatcher(this.eventConst.CREATION_COMPLETE,this,this)}}),s.prototype.getContext=function(){var t;return this.canvasContext=this.$canvas.get(0).getContext("2d"),t=this.$canvas.offset(),this.offsetX=t.left,this.offsetY=t.top,this.canvasContext},s.prototype.setTool=function(t){this.mode=t},s.prototype.clearCanvas=function(){this.canvasContext.clearRect(0,0,this.$el.width(),this.$el.height())},s.prototype.handleMouseEvents=function(){var t=this;this.$canvas.mousedown(function(s){t.handleMouseDown(s)}),this.$canvas.mousemove(function(s){t.handleMouseMove(s)}),this.$canvas.mouseup(function(s){t.handleMouseUp(s)}),this.$canvas.mouseout(function(s){t.handleMouseOut(s)})},s.prototype.handleMouseDown=function(t){this.mouseX=parseInt(t.clientX-this.offsetX),this.mouseY=parseInt(t.clientY-this.offsetY),this.lastX=this.mouseX,this.lastY=this.mouseY,this.isMouseDown=!0},s.prototype.handleMouseUp=function(){this.isMouseDown=!1},s.prototype.handleMouseOut=function(){this.isMouseDown=!1},s.prototype.canvasStroke=function(t,s,e,o){this.canvasContext.globalCompositeOperation="source-over",this.canvasContext.moveTo(t,s),this.canvasContext.lineTo(e,o),this.canvasContext.stroke()},s.prototype.handleMouseMove=function(t){if(this.mouseX=parseInt(t.clientX-this.offsetX),this.mouseY=parseInt(t.clientY-this.offsetY),this.isMouseDown){if(this.canvasContext.beginPath(),"pencil"===this.mode)this.canvasStroke(this.lastX,this.lastY,this.mouseX,this.mouseY);else if("brush"===this.mode)this.canvasStroke(this.lastX,this.lastY,this.mouseX,this.mouseY),this.canvasContext.lineWidth=10,this.canvasContext.lineJoin=this.canvasContext.lineCap="round";else if("cryon"===this.mode)this.canvasStroke(this.lastX-this.getRandomInt(0,6),this.lastY-this.getRandomInt(0,6),this.mouseX-this.getRandomInt(0,2),this.mouseY-this.getRandomInt(0,2)),this.canvasStroke(this.lastX,this.lastY,this.mouseX,this.mouseY),this.canvasStroke(this.lastX+this.getRandomInt(0,6),this.lastY+this.getRandomInt(0,6),this.mouseX+this.getRandomInt(0,4),this.mouseY+this.getRandomInt(0,4));else if("spray"===this.mode){this.canvasContext.globalCompositeOperation="source-over";var s=this.getRandomInt(-10,10),e=this.getRandomInt(-10,10);this.canvasContext.fillRect(this.lastX+s,this.lastY+e,1,1),this.canvasContext.moveTo(this.lastX,this.lastY),this.canvasContext.stroke()}else"eraser"===this.mode&&(this.canvasContext.globalCompositeOperation="destination-out",this.canvasContext.arc(this.lastX,this.lastY,5,0,2*Math.PI,!1),this.canvasContext.fill());this.lastX=this.mouseX,this.lastY=this.mouseY}},s.prototype.getRandomInt=function(t,s){return Math.floor(Math.random()*(s-t+1))+t},s.prototype.isValid=function(t){var s;return s="case"===t?!0:!1},s.prototype.CanvasCompSuper=t,s.prototype.destroy=function(){return delete this.objData,this.$el.off("click"),this.CanvasCompSuper.prototype.destroy.call(this,!0)},s});