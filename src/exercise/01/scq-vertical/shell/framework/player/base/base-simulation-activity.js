define(["player/base/base-activity","player/controllers/media-controller","components/confirmpopup/confirm-popup"],function(t,e,o){var n;return n=t.extend({bEditor:!1,objSimPictor:void 0,type:"simulation",nScreenIndex:0,nTotalScreen:0,screenEventName:void 0,bGlobalControls:!1,bGlobalComponents:!1,objScreen:null,objSelectedComp:null,objPathUpdater:null,initialize:function(){}}),n.prototype.moveToNextScreen=function(){var t=this.nScreenIndex;return t=this.nScreenIndex+1,t>=this.nTotalScreen?(t=this.nTotalScreen-1,void 0):(this.launchScreen(t),void 0)},n.prototype.moveToPreviousScreen=function(){var t=this.nScreenIndex;return t-=1,0>t?(t=0,!1):(this.launchScreen(t),void 0)},n.prototype.jumpToScreenByIndex=function(t){return 0>t&&t>=this.nTotalScreen?(console.warn("Provided screen index is not within range!!!!!"),!1):(this.launchScreen(t),void 0)},n.prototype.resetScreen=function(){this.launchScreen(this.nScreenIndex)},n.prototype.launchScreen=function(t){var e=this.endCurrentScreen(),o=this.ActivityEventConst.MIDDLE_SCREEN_LOAD_EVENT;if(this.screenEventName=o,this.removeAllPopupWindow(),e!==!0)throw new Error(this.objErrConst.ERROR_OCCURED_WHILE_DESTROYING_SCREEN_AND_ITS_EVENTS);this.nScreenIndex=t,this.startScreenInitlization()},n.prototype.startScreenInitlization=function(){var t,e={};e.activityRef=this,this.nTotalScreen=this.jsonData.screens.length,e.jsonData=this.jsonData.screens[this.nScreenIndex],this.languageSupport&&(t=this.getScreenText("templateId"+this.nScreenIndex),t&&t.length>0&&(e.jsonData.templateId=t)),void 0===e.jsonData.jsonSource?(e.template=this.objInlineTmplDict,this.objSimPictor.initalize(e,this)):this.loadScreenData(e.jsonData.jsonSource)},n.prototype.loadScreenData=function(t){this.loadJSONData(t,"json","application/json","json",this.onScreenJSONLoadComplete,this.dataLoadErrorHandler)},n.prototype.onScreenJSONLoadComplete=function(t,e){e.jsonData.screens[e.nScreenIndex]=t,e.objDataLoader.off(e.objDataLoader.DATA_LOAD_SUCCESS),e.objDataLoader.off(e.objDataLoader.DATA_LOAD_FAILED),e.startScreenInitlization()},n.prototype.onScreenJSONLoadFailed=function(){throw this.objDataLoader.off(this.objDataLoader.DATA_LOAD_SUCCESS),this.objDataLoader.off(this.objDataLoader.DATA_LOAD_FAILED),new Error(this.objErrConst.ERROR_WHILE_LOADING_FILE)},n.prototype.loadJSONData=function(t,e,o,n,i,r){var a=this;this.objDataLoader.on(this.objDataLoader.DATA_LOAD_SUCCESS,i),this.objDataLoader.on(this.objDataLoader.DATA_LOAD_FAILED,r),this.objDataLoader.load({url:t,dataType:e,contentType:o,returnType:n,scope:a})},n.prototype.onScreenChangeComplete=function(){var t={};t.type=this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,t.task=this.ActivityEventConst.MANAGE_NEXT_BACK_NEVIGATION_BUTTON,t.isFirstScreen=0===this.nScreenIndex,t.screenIndex=this.nScreenIndex,t.controls=this.getNavButtonData(),t.isLastScreen=this.nTotalScreen-1===this.nScreenIndex,this.trigger(this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,t)},n.prototype.initlizeControls=function(){this.bGlobalControls=void 0!==this.jsonData.controls,this.bGlobalComponents=void 0!==this.jsonData.globalComponents},n.prototype.endCurrentScreen=function(){return this.objSimPictor.destroyCurrentScreen()},n.prototype.getNavButtonData=function(){var t,e,o,n=[];for(e=this.jsonData.controls.nevigation.buttons,t=0;t<e.length;t+=1)o={},o.id=e[t].id,o.region=e[t].region,o.method=e[t].methodName,o.param="nextButton"===e[t].type?"isFirstScreen":"isLastScreen",n.push(o);return o={},o.id=this.jsonData.controls.nevigation.id,o.region=this.jsonData.controls.nevigation.region,o.method=this.jsonData.controls.nevigation.methodName,o.param="screenIndex",n.push(o),n},n.prototype.updateNevigationControl=function(t){return void 0===this.objScreen[t.id]?(console.warn(t.id+" not found!!!!!"),void 0):(this.objScreen[t.id][t.method].apply(this.objScreen[t.id],[t.param]),void 0)},n.prototype.setStageValue=function(t){this.nScaleValue=t,void 0!==this.objSimPictor&&this.objSimPictor.setStageScaleValue(this.nScaleValue)},n.prototype.onScreenChangEvent=function(t){this.launchScreen(t.screenIndex)},n.prototype.toggleMedia=function(t){t===!0?e.getInstance().pauseAllMedia():e.getInstance().resumeAllMedia()},n.prototype.setLocalText=function(){},n.prototype.onPopupClose=function(t){void 0!==this.objScreen.onPopupClose?this.objScreen.onPopupClose(t):void 0!==this.objScreenHelper.onPopupClose&&this.objScreenHelper.onPopupClose(t)},n.prototype.onPopupAddedInDom=function(t){void 0!==this.objScreenHelper.onPopupAddedInDom&&this.objScreenHelper.onPopupAddedInDom(t)},n.prototype.onCompUpdatedFromSelector=function(t){t.customData.regionToUpdate=t.customData.compData.regionToUpdate,this.broadcastEvent(t.type,t.customData)},n.prototype.onComponentSelected=function(t){var e=t.target.componentSelector;t.selectorRef=e,this.handleEditorEvents(this.ActivityEventConst.COMPONENT_SELECTED,t)},n.prototype.onComponentRightClick=function(t){this.broadcastEvent("onComponentRightClickEvent",t.customData)},t.prototype.modifyActivityListInRegion=function(t,e,o,n,i){var r={};r.regionId=t,r.strActList=e,r.regionToUpdate=t,r.immediateStart=n,r.bAdd=o,r.data=i,r.task=this.ActivityEventConst.APPEND_ACTIVITY_IN_REGION,r.type=this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,this.trigger(this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,r)},n.prototype.onComponentTabBtnClick=function(t){this.objSimPictor.selectComponent(t)},n.prototype.onComponentDeselected=function(t){this.handleEditorEvents(this.ActivityEventConst.COMPONENT_DESELECTED,t)},n.prototype.deselectComponent=function(){this.objSelectedComp&&(this.objSelectedComp.isSelected(!1),this.objSelectedComp=void 0)},n.prototype.selectComponent=function(t,e){this.deselectComponent(),this.objSelectedComp&&(this.objSelectedComp.isSelected(!1,e),this.objSelectedComp=void 0)},n.prototype.manageWebServiceCall=function(t){var e={};e.task=this.ActivityEventConst.EXECUTE_WEB_SERVICE_CALL,e.type=this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,e.customData=t,this.trigger(this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,e)},n.prototype.executeUserLastActionFromOtherRegion=function(t){var e={};e.task=this.ActivityEventConst.EXECUTE_USER_LAST_ACTION_FROM_ANOTHER_REGION,e.type=this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,e.customData=t,this.trigger(this.ActivityEventConst.PLAYER_COMMON_TASK_EVENT,e)},n.prototype.getRegionChangeNotification=function(t){this.objScreenHelper&&void 0!==this.objScreenHelper.getRegionChangeNotification&&this.objScreenHelper.getRegionChangeNotification(t)},n.prototype.flush=function(){this.deselectComponent()},n.prototype.showAlert=function(t){var e=new o(t);return this.PopupManager.getInstance().launchPopup(e),e},n.prototype.refreshActivityData=function(t){this.objScreenHelper.refreshHelperScreen(t)},n.prototype.handlePlayerCommonBubbleEvent=function(t){this.objScreenHelper&&this.objScreenHelper.handlePlayerCommonBubbleEvent&&this.objScreenHelper.handlePlayerCommonBubbleEvent.call(this.objScreenHelper,t)},n.prototype.BaseSimulationActivitySuper=t,n.prototype.destroy=function(t){return this.BaseSimulationActivitySuper.prototype.destroy.call(this,t)},n});