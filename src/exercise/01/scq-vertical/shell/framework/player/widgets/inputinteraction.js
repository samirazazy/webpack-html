!function(t){t.widget("Template.FIB",t.custom.BASEWIDGET,{options:{totalQuestion:0,$arrInputField:null,answerArray:null,result:null,caseSenstive:!0,responseSeperator:"|",groups:{},styleIncorrect:void 0,styleCorrect:void 0,feedbackType:1,functionList:["checkAnswer","reset","disable","hideFeedback","showAnswer"]},_create:function(){},_init:function(){this.dispatchEvent("ON_INIT"),this.options.answerArray=[],this.options.result={totalAttempt:0,totalIncorrect:0,totalCorrect:0,totalQuestions:0},this._trigger("testEvent");var e=this;this.options.widgetData.caseSenstive&&(this.options.caseSenstive=this.options.widgetData.caseSenstive),this.options.widgetData.responseSeperator&&(this.options.responseSeperator=this.options.widgetData.responseSeperator),this.options.widgetData.styleIncorrect&&(this.options.styleIncorrect=this.options.widgetData.styleIncorrect),this.options.widgetData.styleCorrect&&(this.options.styleCorrect=this.options.widgetData.styleCorrect),this.options.widgetData.feedbackType&&(this.options.feedbackType=this.options.widgetData.feedbackType),$arrInputField=this.options.parentDiv.find("[type = inputInteraction]"),this.options.result.totalQuestions=$arrInputField.length,t.each($arrInputField,function(s){var o,i,r,n;o=t(this),i="input"+s,o.attr("id",i),r=o.attr("ans").split(e.options.responseSeperator),e.options.answerArray.push(r),o.removeAttr("ans"),1===e.options.feedbackType?(n=t("<div style='position:relative; display:inline-block;'></div>"),n.prop("correct",t("<div class='"+e.options.styleCorrect+"'></div>")),n.append(n.prop("correct")),n.prop("incorrect",t("<div class='"+e.options.styleIncorrect+"'></div>")),n.append(n.prop("incorrect")),o.prop("feedback",n)):2===e.options.feedbackType&&t(this).prop("styleAtr",t(this).attr("style")),o.keyup(function(){var t={};t.isAllfilled=e._isAllfilled(),e._trigger("ON_CHANGE",{},t),e.dispatchEvent("ON_CHANGE",{},t)}),o.focus(function(){var t={};t.element=o,e._trigger("ON_FOCUS",{},t),e.dispatchEvent("ON_FOCUS",{},t)})}),t(e.element).show()},_isAllfilled:function(){var e=!0;return t.each($arrInputField,function(){""==t(this).val()&&(e=!1)}),e},checkAnswer:function(e){var s,o=this;this.options.result.totalAttempt+=1,this.options.result.totalCorrect=0,this.options.result.totalIncorrect=0,void 0!==e&&this.disable(!0,e),this.options.groups={},t.each($arrInputField,function(e){s=o.options.answerArray[e],o._checkMatch(s,t(this).val())&&o._checkGroupUniqueResponse(t(this),t(this).val())?(o.options.result.totalCorrect+=1,o._showCorrectFeedback(t(this))):(o.options.result.totalIncorrect+=1,o._showIncorrectFeedback(t(this)))}),this._trigger("ON_CHECK_ANSWER"),this.dispatchEvent("ON_CHECK_ANSWER",this,o.options.result)},_checkMatch:function(e,s){var o=this,i=[];return o.options.caseSenstive?(i=null,i=e):(t.each(e,function(t,e){i.push(e.toLowerCase())}),s=s.toLowerCase()),-1==i.indexOf(s)?!1:!0},_checkGroupUniqueResponse:function(t,e){var s,o=t.attr("grp");return this.options.caseSenstive||(e=e.toLowerCase()),void 0!==o&&0!==o.length?void 0===this.options.groups[o]?(this.options.groups[o]=[e],!0):(s=this.options.groups[o],-1===s.indexOf(e)?(s.push(e),!0):!1):!0},reset:function(e){var s,o,i=this;void 0!==e&&"ALL"!==e&&(this.options.groups={}),t.each($arrInputField,function(r){"ALL"===e||void 0===e?(t(this).val("").removeAttr("disabled"),i._resetFeedback(t(this))):(s=i.options.answerArray[r],o=i._checkMatch(s,t(this).val())&&i._checkGroupUniqueResponse(t(this),t(this).val()),"CORRECT"===e?o&&(t(this).val("").removeAttr("disabled"),i._resetFeedback(t(this))):"INCORRECT"===e&&(o||(t(this).val("").removeAttr("disabled"),i._resetFeedback(t(this)))))}),this._trigger("ON_RESET"),this.dispatchEvent("ON_RESET")},_showCorrectFeedback:function(e){1===this.options.feedbackType?(t(e).prop("feedback").prop("correct").show(),t(e).prop("feedback").prop("incorrect").hide(),t(e).after(t(e).prop("feedback"))):2===this.options.feedbackType&&(void 0!==this.options.styleIncorrect?t(e).removeClass(this.options.styleIncorrect):t(e).attr("style",t(e).prop("styleAtr")),void 0!==this.options.styleCorrect?t(e).addClass(this.options.styleCorrect):t(e).css("border","1px solid green"))},_showIncorrectFeedback:function(e){1===this.options.feedbackType?(t(e).prop("feedback").prop("incorrect").show(),t(e).prop("feedback").prop("correct").hide(),t(e).after(t(e).prop("feedback"))):2===this.options.feedbackType&&(void 0!==this.options.styleCorrect?t(e).removeClass(this.options.styleCorrect):t(e).attr("style",t(e).prop("styleAtr")),void 0!==this.options.styleIncorrect?t(e).addClass(this.options.styleIncorrect):t(e).css("border","1px solid red"))},_resetFeedback:function(e){1===this.options.feedbackType?t(e).prop("feedback").remove():2===this.options.feedbackType&&(void 0!==this.options.styleCorrect?t(e).removeClass(this.options.styleCorrect):(t(e).attr("style",t(e).prop("styleAtr")),t(e).css("border","")),void 0!==this.options.styleIncorrect?t(e).removeClass(this.options.styleIncorrect):(t(e).attr("style",t(e).prop("styleAtr")),t(e).css("border","")))},disable:function(e,s){var o,i,r=this;this.options.groups={},t.each($arrInputField,function(n){"ALL"===s||void 0===s?e?t(this).attr("disabled","true"):t(this).removeAttr("disabled"):(i=r.options.answerArray[n],o=r._checkMatch(i,t(this).val())&&r._checkGroupUniqueResponse(t(this),t(this).val()),"CORRECT"===s?o&&(e?t(this).attr("disabled","true"):t(this).removeAttr("disabled")):"INCORRECT"===s&&(o||(e?t(this).attr("disabled","true"):t(this).removeAttr("disabled"))))})},hideFeedback:function(e){var s,o,i=this;this.options.groups={},t.each($arrInputField,function(r){"ALL"===e||void 0===e?i._resetFeedback(this):(o=i.options.answerArray[r],s=i._checkMatch(o,t(this).val())&&i._checkGroupUniqueResponse(t(this),t(this).val()),"CORRECT"===e?s&&i._resetFeedback(this):"INCORRECT"===e&&(s||i._resetFeedback(this)))})},showAnswer:function(e,s){var o,i,r=this;void 0!==e&&this.disable(!0,e),void 0!==s&&this.hideFeedback(s),answerArray=r.options.answerArray.slice(0),o=[],this.options.groups={},t.each($arrInputField,function(e){i=r.options.answerArray[e],o[e]=r._checkMatch(i,t(this).val())&&r._checkGroupUniqueResponse(t(this),t(this).val())?null:this}),t.each(o,function(e){var s,n,a=0;if(o[e])for(i=r.options.answerArray[e],a=i.length,s=0;a>s;){if(n=i[s],r._checkMatch(i,n)&&r._checkGroupUniqueResponse(t(this),n)){t(this).val(n);break}s+=1}}),this._trigger("ON_SHOW_ANSWER"),this.dispatchEvent("ON_SHOW_ANSWER")},result:function(){return this.options.result},destroy:function(){console.log("destory!!!!!")}})}(jQuery);