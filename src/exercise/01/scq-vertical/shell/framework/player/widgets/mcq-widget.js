!function(e){e.widget("Template.MCQ",e.custom.BASEWIDGET,{options:{answersArray:[],answersCheckedOrder:[],functionList:["reset","showAnswer","result","showFeedback","hideFeedback","disable","enable"]},_create:function(){},_init:function(){this.dispatchEvent("ON_INIT");var t,s,i=this,n=i.element;if(t=parseInt(n.attr("ques"))-1,i.options.answersArray[t]=n.attr("ans").trim().split("|"),n.removeAttr("ans"),i.options.answersCheckedOrder[t]=new Array,s=i.options.answersArray[t].slice(0),e.each(n.find('[data-type="option"]'),function(e){var e=s.indexOf((e+1).toString());-1!==e&&s.splice(e,1)}),0!==s.length)throw"Question number "+(t+1)+" has wrong options";n.removeAttr("answers"),n.find('[data-type="option"]').off("click").on("click",function(){var s=e(this).hasClass("active");s?e(this).removeClass("active"):e(this).addClass("active"),i._checkIfthisOptionsExist("ctype","clickWords")&&(e(this).addClass("active"),s=!1),i._checkAnswer(t,n.find('[data-type="option"]').index(e(this)),n,!s)})},_checkIfthisOptionsExist:function(e,t){return this.options.hasOwnProperty("widgetData")&&this.options.widgetData[e]==t?!0:!1},_arraysIdentical:function(e,t){if(e.length!==t.length)return!1;for(var s=e.length;s--;)if(e[s]!==t[s])return!1;return!0},_checkAnswer:function(e,t,s,i){console.log(this.options);var n=this.options.answersCheckedOrder[e].slice(0),a=this.options.answersArray[e];if(i)this._checkIfthisOptionsExist("ctype","clickWords")||this._checkIfthisOptionsExist("autoUncheck",!0)?-1==n.indexOf((t+1).toString())&&n.push((t+1).toString()):n.push((t+1).toString());else{var r=n.indexOf((t+1).toString());n.splice(r,1)}if(this.options.answersCheckedOrder[e]=n,!this._checkIfthisOptionsExist("autoUncheck",!0)&&n.length>a.length){var o=s.find('[data-type="option"]').eq(parseInt(n.shift())-1);o.removeClass("active"),"INPUT"===o.get(0).tagName&&o.attr("checked",!1)}this._arraysIdentical(n.slice(0).sort(),a.slice(0).sort())?(s.find(".feedback").remove(),this.dispatchEvent("ON_CORRECT_ANSWER",{},s)):(s.find(".feedback").remove(),this.dispatchEvent("ON_INCORRECT_ANSWER",{},s))},reset:function(){this.element.find('[data-type="option"]').each(function(){e(this).removeAttr("disabled")}),this.element.find('[data-type="option"]').removeClass("active"),"INPUT"===this.element.find('[data-type="option"]').get(0).tagName&&this.element.find('[data-type="option"]').attr("checked",!1);for(var t in this.options.answersCheckedOrder)this.options.answersCheckedOrder[t]=new Array;e(".feedback").remove(),this.dispatchEvent("ON_RESET")},showAnswer:function(){e(".feedback").remove();var t=this,s=parseInt(t.element.attr("ques"))-1;t.element.find('[data-type="option"]').removeClass("active"),"INPUT"===t.element.find('[data-type="option"]').get(0).tagName&&t.element.find('[data-type="option"]').attr("checked",!1),t.options.answersCheckedOrder[s]=t.options.answersArray[s],e.each(t.element.find('[data-type="option"]'),function(i){-1!==t.options.answersArray[s].indexOf((i+1).toString())&&("INPUT"===e(this).get(0).tagName&&(this.checked=!0),e(this).addClass("active"))}),this.dispatchEvent("ON_SHOW_ANSWER")},result:function(){var e=[],t=parseInt(this.element.attr("ques"))-1;console.log(this.options.answersArray);for(var s=0;s<this.options.answersArray.length;s++)e[s+1]=this._arraysIdentical(this.options.answersArray[s],this.options.answersCheckedOrder[s])?1:0;this.options.answersArray.length===t+1&&this.dispatchEvent("ON_SHOW_RESULT",{},e)},showFeedback:function(){var t=parseInt(this.element.attr("ques"))-1;this.element.find(".feedback").remove();for(var s in this.options.answersCheckedOrder[t])if(-1!==this.options.answersArray[t].indexOf(this.options.answersCheckedOrder[t][s])){var i=e('<div style="display: inline-block" class="feedback correct"></div>');this.element.find('[data-type="option"]').eq(parseInt(this.options.answersCheckedOrder[t][s])-1).parent().append(i)}else{var n=e('<div style="display: inline-block" class="feedback incorrect"></div>');this.element.find('[data-type="option"]').eq(parseInt(this.options.answersCheckedOrder[t][s])-1).parent().append(n)}this.dispatchEvent("ON_SHOW_FEEDBACK")},disable:function(){this.element.css("position","relative","z-index","0").prepend('<div class="widget_disabled" style="position: absolute;height: 100%;width: 100%" ></div>'),this.element.find('[data-type="option"]').each(function(){e(this).attr("disabled","disabled")}),this.dispatchEvent("ON_DISABLE")},enable:function(){this.element.find(".widget_disabled").remove(),this.element.find('[data-type="option"]').each(function(){e(this).removeAttr("disabled")}),this.dispatchEvent("ON_ENABLE")},hideFeedback:function(){e(".feedback").remove(),this.dispatchEvent("ON_HIDE_FEEDBACK")},destroy:function(){this.options.answersCheckedOrder.length=0,this.options.answersArray.length=0,this.element.remove()}})}(jQuery);